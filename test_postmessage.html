<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>postMessage Bridge Test</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, sans-serif;
      background: #f3f4f6;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 {
      color: #1f2937;
      margin-bottom: 20px;
    }
    .iframe-container {
      width: 100%;
      height: 600px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
    }
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    button {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    button:active {
      transform: translateY(0);
    }
    .info {
      background: #f0f9ff;
      border: 1px solid #bfdbfe;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .log {
      background: #1f2937;
      color: #f9fafb;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry {
      margin-bottom: 5px;
      padding: 3px 0;
      border-bottom: 1px solid #374151;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-entry.success { color: #6ee7b7; }
    .log-entry.error { color: #fca5a5; }
    .log-entry.info { color: #93c5fd; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”Œ postMessage Bridge Test - v7.5-main Viewer</h1>

    <div class="info">
      <strong>Instructions:</strong> This page tests the cross-origin postMessage bridge.
      Use the buttons below to send commands to the iframe.
      Check the log for responses.
    </div>

    <div class="iframe-container">
      <iframe
        id="presentation-iframe"
        src="http://localhost:8504/p/92efc791-d99b-44eb-b777-adfa6e1c8e54"
      ></iframe>
    </div>

    <div class="controls">
      <h3>Navigation Controls</h3>
      <div class="button-group">
        <button onclick="sendCmd('prevSlide')">â¬…ï¸ Previous</button>
        <button onclick="sendCmd('nextSlide')">Next â¡ï¸</button>
        <button onclick="sendCmd('getCurrentSlideInfo')">â„¹ï¸ Get Slide Info</button>
        <button onclick="sendCmd('goToSlide', {index: 5})">Go to Slide 5</button>
      </div>

      <h3>Edit Mode Controls</h3>
      <div class="button-group">
        <button onclick="sendCmd('toggleEditMode')">âœï¸ Toggle Edit</button>
        <button onclick="sendCmd('saveAllChanges')">ğŸ’¾ Save Changes</button>
        <button onclick="sendCmd('cancelEdits')">âŒ Cancel Edits</button>
      </div>

      <h3>View Controls</h3>
      <div class="button-group">
        <button onclick="sendCmd('toggleOverview')">ğŸ“Š Toggle Overview</button>
        <button onclick="sendCmd('isOverviewActive')">ğŸ” Check Overview Status</button>
      </div>

      <h3>Debug Functions</h3>
      <div class="button-group">
        <button onclick="sendCmd('toggleGridOverlay')">ğŸ¯ Toggle Grid</button>
        <button onclick="sendCmd('toggleBorderHighlight')">ğŸ”² Toggle Borders</button>
      </div>

      <h3>Test Log</h3>
      <div class="log" id="log"></div>
    </div>
  </div>

  <script>
    const iframe = document.getElementById('presentation-iframe');
    const logEl = document.getElementById('log');
    const VIEWER_ORIGIN = 'http://localhost:8504';

    // Log function
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
      console.log(message);
    }

    // Listen for responses from iframe
    window.addEventListener('message', (event) => {
      if (event.origin !== VIEWER_ORIGIN) return;

      const { action, success, error, data } = event.data;

      if (success) {
        log(`âœ… ${action} - SUCCESS ${JSON.stringify(data || {})}`, 'success');
      } else {
        log(`âŒ ${action} - FAILED: ${error}`, 'error');
      }
    });

    // Send command to iframe
    function sendCmd(action, params = {}) {
      log(`ğŸ“¤ Sending: ${action} ${JSON.stringify(params)}`, 'info');
      iframe.contentWindow.postMessage({ action, params }, VIEWER_ORIGIN);
    }

    // Wait for iframe to load
    iframe.addEventListener('load', () => {
      log('ğŸ‰ Iframe loaded - ready to test!', 'success');
    });

    log('ğŸš€ Test page initialized', 'info');
  </script>
</body>
</html>
